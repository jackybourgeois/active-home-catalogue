<!--
  #%L
  Active Home :: Store
  $Id:$
  $HeadURL:$
  %%
  Copyright (C) 2016 org.activehome
  %%
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as
  published by the Free Software Foundation, either version 3 of the 
  License, or (at your option) any later version.
  
  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.
  
  You should have received a copy of the GNU General Public 
  License along with this program.  If not, see
  <http://www.gnu.org/licenses/gpl-3.0.html>.
  #L%
  -->
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/iron-icon/iron-icon.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/bower_components/iron-icons/image-icons.html">
<link rel="import" href="/bower_components/paper-card/paper-card.html">

<dom-module id="store-item">

    <template>

        <style>

            .version {
                display: inline;
                padding: .2em .6em;
                font-size: 75%;
                font-weight: 700;
                line-height: 1;
                color: #fff;
                text-align: center;
                white-space: nowrap;
                vertical-align: baseline;
                -webkit-border-radius: 0.25em;
                -moz-border-radius: 0.25em;
                -ms-border-radius: 0.25em;
                -o-border-radius: 0.25em;
                border-radius: 0.25em;
                position: absolute;
                top: -5px;
                right: -5px;
            }

            .itemIcon {
                width: 60px;
                float: left;
                margin: 5px;
            }

            :host {
                --paper-card-header-text: {
                    font-size: 14px;
                    font-weight: bold;
                };
            }

            .label {
                font-size: 10px;
                margin-top: -5px;
            }


        </style>

        <paper-card id="itemCard" heading="{{formattedName}}" style="width: 300px; margin: 10px" >
            <div class="card-content" style="height: 100px;text-align: left">
                <span id="versionType" class="version">v. {{version}}</span>
                <span style="text-align: left">{{description}}</span>
            </div>
            <div class="card-actions" style="text-align: center" >
                <div style="width:40px; float:left;">
                    <paper-icon-button on-click="install" icon="get-app" style="margin-bottom:-20px"></paper-icon-button>
                    <span class="label">Install</span>
                </div>
                <div style="width:40px; float:left;">
                    <paper-icon-button on-click="demo" icon="image:remove-red-eye" style="margin-bottom:-20px"></paper-icon-button>
                    <span class="label">Demo</span>
                </div>
                <div style="width:40px; float:left;">
                    <paper-icon-button on-click="showDoc" icon="description" style="margin-bottom:-20px"></paper-icon-button>
                    <span class="label">Docs</span>
                </div>
                <div style="width:40px; float:left;">
                    <paper-icon-button on-click="showSource" icon="code" style="margin-bottom:-20px"></paper-icon-button>
                    <span class="label">Source</span>
                </div>
            </div>
        </paper-card>

    </template>

    <script>
        Polymer({
            is: 'store-item',
            properties: {
                formattedName: {
                    type: String,
                    value: "-"
                },
                name: {
                    type: String,
                    value: "-",
                    observer: "formatName"
                },
                version: {
                    type: String,
                    value: "-",
                    observer: "formatVersion"
                },
                description: {
                    type: String,
                    value: "-"
                },
                doc: {
                    type: String,
                    value: ""
                },
                demoScript: {
                    type: String,
                    value: ""
                },
                st: {
                    type: String,
                    value: "",
                    observer: "formatSuperType"
                }
            },
            defaultHeight: 2,
            defaultWidth: 2,
            defaultAttributes: {},
            imports: [],

            ready: function () {

            },

            formatName: function() {
                this.formattedName = "";
                var wordArray = this.name.split(/(?=[A-Z])/);
                for (var i=0; i<wordArray.length; i++) {
                    this.formattedName += wordArray[i];
                    if (wordArray[i].length>1) {
                        this.formattedName += " ";
                    }
                }
            },

            formatVersion: function() {
                if (this.version.endsWith("SNAPSHOT")) {
                    this.$.versionType.style.background = "orangered";
                } else {
                    this.$.versionType.style.background = "green";
                }
            },

            formatSuperType: function() {
                this.$.itemCard.style.background = this.getColourFromType();
            },

            getColourFromType: function () {
                if (this.name=="User") {
                    this.st="User";
                }
                switch (this.st) {
                    case "IO": return "#d38d5f";
                    case "Appliance": return "#d38d5f";
                    case "MicroGeneration": return "#d38d5f";
                    case "Storage": return "#d38d5f";
                    case "Meter": return "#d38d5f";
                    case "FiscalMeter": return "#d38d5f";
                    case "BackgroundAppliance": return "#d38d5f";
                    case "InteractiveAppliance": return "#d38d5f";
                    case "API": return "#afdde9";
                    case "Predictor": return "#ffaa80";
                    case "Evaluator": return "#ffce80";
                    case "Context": return "#e980ff";
                    case "Service": return "#ffe680";
                    case "User": return "#aaffaa";
                    default: return "#ffffff";
                }
            },

            install: function () {
//                var widget = {};
//                widget.type = "org.activehome.ui.WidgetView";
//                widget.id = "${node}.widget-" + this.guid();
//                widget.x = 0;
//                widget.y = 0;
//                widget.width = this.defaultWidth;
//                widget.height = this.defaultHeight;
//                widget.component = this.widgetId;
//                widget.attributes = this.defaultAttributes;
//                widget.import = this.imports.split(",");
//                var ajax = document.querySelector("store-view").install(widget);
            },

            demo: function() {
                console.log(this.demoScript);
            },

            showSource: function() {
                console.log("show source");
            },

            showDoc: function() {
                console.log(this.doc);
                this.fire('select-info-bt', {doc: this.doc});
            },

            guid: function () {
                function s4() {
                    return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
                }

                return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
                        s4() + '-' + s4() + s4() + s4();
            }
        });
    </script>
</dom-module>